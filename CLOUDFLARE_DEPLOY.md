# Деплой на Cloudflare Pages

## Проблема
При деплое на Cloudflare Pages возникает ошибка:
```
Error: Pages only supports files up to 25 MiB in size
cache/webpack/server-production/0.pack is 32.2 MiB in size
```

## Решение

### 1. Очистка проекта
Перед деплоем выполните полную очистку:
```bash
npm run clean:full
```

### 2. Оптимизированная сборка
Используйте команду для оптимизированной сборки:
```bash
npm run build:full
```

### 3. Деплой
```bash
npm run deploy
```

## Что было исправлено

### Конфигурация Next.js
- Отключены экспериментальные функции
- Оптимизирован webpack для уменьшения размера
- Отключены source maps
- Настроена оптимизация чанков

### Исключение больших файлов
- Создан `.wranglerignore` для исключения ненужных файлов
- Настроен `.cloudflare/pages.toml` для Cloudflare Pages
- Исключены папки кэша и большие файлы webpack

### Скрипты очистки
- `clean:full` - полная очистка проекта
- `build:full` - очистка + сборка
- `deploy` - полная очистка + сборка + деплой

## Структура файлов конфигурации

```
.cloudflare/
  pages.toml          # Конфигурация Cloudflare Pages
.wranglerignore       # Исключения для Wrangler
next.config.js        # Оптимизированная конфигурация Next.js
scripts/
  clean-build.js      # Скрипт очистки
```

## Важные моменты

1. **Всегда используйте `npm run build:full`** перед деплоем
2. **Не коммитьте папку `.next`** в git
3. **Используйте `.wranglerignore`** для исключения больших файлов
4. **Проверяйте размер файлов** перед деплоем

## Проверка размера файлов

Перед деплоем проверьте размер папки `.next`:
```bash
du -sh .next
```

Если размер больше 100 МБ, выполните полную очистку:
```bash
npm run clean:full
npm run build:full
```

## Альтернативные решения

Если проблема сохраняется:

1. **Используйте статический экспорт**:
   ```js
   // next.config.js
   output: 'export'
   ```

2. **Настройте CDN** для больших файлов

3. **Используйте Cloudflare Workers** вместо Pages

## Поддержка

При возникновении проблем:
1. Проверьте логи сборки
2. Убедитесь, что все зависимости актуальны
3. Выполните полную очистку проекта
4. Проверьте размер генерируемых файлов
